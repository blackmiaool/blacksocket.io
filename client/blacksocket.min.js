!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(module,exports,__webpack_require__){"use strict";function io(){function e(t){if(a.closed)return void(r&&clearInterval(r));a.ws&&a.ws.close(),n=new WS(t),n.addEventListener("close",function(n){r&&clearInterval(r),r=setInterval(function(){e(t)},5e3)}),n.addEventListener("open",function(e){r&&(clearInterval(r),r=0)}),a.init(n)}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",n=void 0,r=void 0,i=isBrowser?location.protocol.replace("http","ws"):"ws:",o=isBrowser?location.hostname:"localhost";if(!t.startsWith(":")&&!t.startsWith("/"))throw new Error("invalid addr"+t);t=i+"//"+o+t;var a=new Socket;return e(t),setInterval(function(){n.readyState==WS.OPEN&&n.send(Math.floor(1e3*Math.random())+"")},25e3),a}var Socket=__webpack_require__(1),isBrowser="undefined"!=typeof location,WS=void 0;WS=isBrowser?WebSocket:eval("require('ws')"),module.exports=io},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){if(!e)return!1;var t=Object.getPrototypeOf(e).constructor.name;return"ArrayBuffer"===t||"Buffer"===t}function o(e){return e&&"object"===(void 0===e?"undefined":c(e))}function a(e){function t(e,r){for(var a in e)i(e[a])?(r.push(a),n.paths.push(r.slice()),n.buffers.push(e[a]),r.pop()):o(e)&&(r.push(a),t(e[a],r),r.pop())}if(!o(e))return null;var n={paths:[],buffers:[]};return i(e)?(n.paths.push([]),n.buffers.push(e),n):(t(e,[]),n.paths.length?n:null)}function s(e,t,n){if(!t.includes("constructor")&&!t.includes("__proto__"))return t[0]?(t.reduce(function(e,r,i){return i===t.length-1?void(e[r]=n):e[r]},e),e):n}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=function(){function e(){r(this,e),Object.assign(this,{uid:1,eventListenerMap:{},cbMap:{},firstConnect:!0,closed:!1})}return u(e,[{key:"init",value:function(e){var t=this;this.ws=e,this.binaryData=[],this.binaryMsgQueue=[],e.addEventListener("message",function(e){var n=void 0,r=void 0;if(i(e.data)){if(!t.binaryInfo)return;n=e.data,r=t.binaryInfo}else if(!e.data||"{"!==e.data[0])return;r||(r=JSON.parse(e.data));var o=r,a=o.uid,u=o.needCb,c=o.data,f=o.event,p=o.type,l=(o.dataType,o.bufferPaths);if(n){var d=l.pop();c=s(c,d,n)}var v=function(){return!(!l||!l.length)&&(t.binaryInfo=r,t.ws.send(JSON.stringify({type:"wait-binary"})),!0)};switch(p){case"msg":if(v())return;if(!t.eventListenerMap[f])return;var h=void 0;u&&(h=function(e){t.sendCb(a,e)}),t.eventListenerMap[f].forEach(function(e){e(c,h)});break;case"wait-binary":t.ws.send(t.binaryData.pop()),!t.binaryData.length&&t.binaryMsgQueue.length&&t.emit.apply(t,t.binaryMsgQueue.shift());break;case"cb":if(v())return;t.cbMap[a]&&t.cbMap[a](c),delete t.cbMap[a]}}),e.addEventListener("open",function(){var e=t.eventListenerMap.connect,n=t.eventListenerMap.reconnect,r=t.eventListenerMap["first-connect"];e&&e.forEach(function(e){e()}),t.firstConnect?(t.firstConnect=!1,r&&r.forEach(function(e){e()})):n&&n.forEach(function(e){e()})}),e.addEventListener("close",function(){var e=t.eventListenerMap.disconnect;e&&e.forEach(function(e){e()})})}}]),u(e,[{key:"open",value:function(){this.closed=!1,this.ws.open()}},{key:"close",value:function(){this.closed=!0,this.ws.close()}},{key:"_send",value:function(e){1===this.ws.readyState?this.ws.send(e):console.log("bug: not ready")}},{key:"emit",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.binaryData.length||this.binaryMsgQueue.length){var o=void 0;return!0===n&&(o=new Promise(function(e){n=e})),this.binaryMsgQueue.push([e,t,n,i]),o}var s={},u=void 0;if(this.binaryData=[],i.cb?s.uid=i.uid:(s.uid=this.uid,this.uid++),n)if(s.needCb=!0,!0===n)u=new Promise(function(e){r.cbMap[s.uid]=function(t){e(t)}});else{if("function"!=typeof n)return void console.warn("expect a function or a true as the third parameter");this.cbMap[s.uid]=n}var c=a(t);return c&&(s.bufferPaths=c.paths,this.binaryData=c.buffers),s.data=t,s.event=e,i.cb?s.type="cb":s.type="msg",this._send(JSON.stringify(s)),u}},{key:"sendCb",value:function(e,t){this.emit(!1,t,!1,{cb:!0,uid:e})}},{key:"once",value:function(e,t){var n=this,r=function r(){var i=n.eventListenerMap[e];t(),i.splice(i.indexOf(r),1)};this.on(e,r)}},{key:"on",value:function(e,t){this.eventListenerMap[e]||(this.eventListenerMap[e]=[]),this.eventListenerMap[e].push(t)}}]),e}();e.exports=f}])});